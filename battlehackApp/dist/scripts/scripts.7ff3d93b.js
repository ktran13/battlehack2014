"use strict";angular.module("battlehackApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","restangular","ui.bootstrap","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl as mainCtrl"}).when("/search",{templateUrl:"views/discover.html",controller:"DiscoverCtrl as discoverCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"contactCtrl as contactCtrl"}).when("/profile",{templateUrl:"views/profile.html",controller:"profileCtrl as profileCtrl"}).when("/confirm",{templateUrl:"views/confirm.html",controller:"ConfirmCtrl as confirmCtrl"}).otherwise({redirectTo:"/"})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("bh")}]).config(function(a){a.setBaseUrl("http://fundmatch.org:8080/FundMatchAPI/v1/")}),function(){var a="NavCtrl",b=function(a,b,c){var d=this;d.showNav=!0,c.getAuthToken(),d.donate=function(){var a="fm";b.url("/profile?id="+a)}};angular.module("battlehackApp").controller(a,["$log","$location","paypalService","sharethisService",b])}(),function(){var a="MainCtrl",b=function(a,b,c,d,e,f,g){a.debug(g.test()),a.debug(e.test())};angular.module("battlehackApp").controller(a,["$log","$scope","$location","$window","dataService","paypalService","sharethisService",b])}(),function(){var a="ConfirmCtrl",b=function(a,b,c,d,e,f,g){var h=this;g.getAuthToken(),a.debug(e);var i=e.confirm;h.payerId=e.PayerID,h.amount=e.amount,a.debug(h.payerId),i&&(h.showExecuteButton=!0),h.execute=function(b){g.executePayment(b).then(function(b){a.debug("success in payment"),a.debug(b),h.purchasingdata=b,h.donationName=f.getDonationName(),h.showExecuteButton=!1,h.showThankyouView=!0},function(b){a.debug(b),a.debug("error executing payment")})},h.discover=function(){d.path("/search")}};angular.module("battlehackApp").controller(a,["$log","$scope","$window","$location","$routeParams","dataService","paypalService",b])}(),function(){var a="contactCtrl",b=function(a,b,c,d,e){a.debug(e.test()),a.debug(c.test())};angular.module("battlehackApp").controller(a,["$log","$scope","dataService","paypalService","sharethisService",b])}(),function(){var a="DiscoverCtrl",b=function(a,b,c,d,e){var f=this;f.isCollapsed=!1,a.debug(e.test()),c.getDatabase().then(function(b){f.nonprofits=b.results,a.debug(b.results[0]),a.debug("success!")},function(b){a.debug("error!"),a.debug(b)})};angular.module("battlehackApp").controller(a,["$log","$scope","dataService","paypalService","sharethisService",b])}(),function(){var a="profileCtrl",b=function(a,b,c,d,e,f,g,h){var i=this;a.debug(g.test()),a.debug(e.test());var j=d.donate;j?i.showApproveButton=!0:i.showDonateButton=!0,i.approve=function(){var a=h.get("approve");c.location.href=a},i.donation={},i.donate=function(b){if(b.$valid){var c=123,d=i.donation.donationAmount,e="fund name";f.setupPayment(e,c,d).then(function(b){a.debug("successfully donated"),a.debug(b),i.showDonateButton=!1,i.showApproveButton=!0})}else b.donationAmount.$dirty=!0,b.donationAmount.$invalid=!0}};angular.module("battlehackApp").controller(a,["$log","$scope","$window","$routeParams","dataService","paypalService","sharethisService","localStorageService",b])}(),function(){angular.module("battlehackApp").factory("paypalRestangular",["Restangular",function(a){return a.withConfig(function(a){a.setBaseUrl("https://api.sandbox.paypal.com/v1/payments/")})}]),angular.module("battlehackApp").factory("authPaypalRestangular",["Restangular",function(a){return a.withConfig(function(a){a.setBaseUrl("https://api.sandbox.paypal.com/v1/oauth2/")})}]),angular.module("battlehackApp").service("paypalService",["$log","$q","paypalRestangular","authPaypalRestangular","localStorageService",function(a,b,c,d,e){var f=e.get("authToken"),g=function(){d.one("token").customPOST("grant_type=client_credentials","",{},{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Accept-language":"en_US",Authorization:"Basic QVRXVURoRGQzTUNkY3FHNUtUU3o5YWJHVzNpbzZDMDFJZWJ3aWlrbTR4N0FwR1FGbkJQSHk4dWRVbWRwOkVMdW9meEE1Sk9wbVdCeHUzNmw1MXE4NGpuVGlqMXN1QlE4S1cwSzRDRnhlSFkwMjZIRkpvN2N1WndOTg=="}).then(function(b){a.debug("success"),a.debug(b),h.value=b.access_token,e.add("authToken",h.value),a.debug(e.get("authToken"))},function(b){a.debug(b),a.debug("error")})},h=f?{value:f}:g(),i=function(d,f,g){var i=f,j={intent:"sale",redirect_urls:{return_url:"http://localhost:9000/#/confirm?id="+i+"&confirm=true&amount="+g.toString(),cancel_url:"http://localhost:9000/#/profile?id="+i+"&confirm=false"},payer:{payment_method:"paypal"},transactions:[{amount:{total:g.toString(),currency:"USD"}}]};return c.one("payment").customPOST(j,"",{},{"Content-Type":"application/json",Authorization:"Bearer "+h.value}).then(function(b){a.debug("successfully submitted"),a.debug(b);var c=_.find(b.links,{rel:"approval_url"}).href,f=_.find(b.links,{rel:"execute"}).href;return e.add("approve",c),e.add("execute",f),e.add("donationName",d),a.debug(e.get("approve")),a.debug(e.get("execute")),b},function(c){return a.debug(c),a.debug("error"),b.reject("error")})},j=function(d){var f={payer_id:d.toString()},i=e.get("execute"),j=i?i.substring(43):null;return a.debug(j),h||g(),j?c.one(j).customPOST(f,"",{},{"Content-Type":"application/json",Authorization:"Bearer "+h.value}):b.reject("no execute url to be found")};return{getAuthToken:g,setupPayment:i,executePayment:j}}])}(),function(){angular.module("battlehackApp").factory("sharethisRestangular",["Restangular",function(a){return a.withConfig(function(a){a.setBaseUrl("http://www.sharethis.com")})}]),angular.module("battlehackApp").service("sharethisService",["Restangular",function(){var a=function(){return"share this"};return{test:a}}])}(),function(){angular.module("battlehackApp").service("dataService",["$log","$http","Restangular","localStorageService",function(a,b,c,d){var e=function(){return"data test"},f=function(a){return c.one("QueryServlet").get({id:a})},g=function(){return d.get("donationName")},h=function(){return a.debug("got database call"),c.one("QueryServlet").get().then(function(a){return a},function(){a.debug("error loading non profit data...")})};return{test:e,getDatabase:h,getNonprofit:f,getDonationName:g}}])}();